<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>
		<script type="text/javascript">
			//åœ°å›¾ç±»
			(function() {
				//åœ°å›¾æ„é€ å‡½æ•°       å®½  é«˜  èƒŒæ™¯è‰²
				function MapG(width, height, bgColor) {
					this.width = width;
					this.height = height;
					this.bgColor = bgColor;
				}
				//å°†åˆå§‹åŒ–æ–¹æ³•å®šä¹‰åˆ°åŸå‹å¯¹è±¡ä¸­
				MapG.prototype.init = function() {
					/*
					 * åŸå‹å¯¹è±¡ä¸­çš„thisæŒ‡å‘çš„æ˜¯å®ä¾‹å¯¹è±¡
					 */
					//åˆ›å»ºåœ°å›¾div
					var divMap = document.createElement('div');
					//è®¾ç½®divçš„cssæ ·å¼
					divMap.style.width = this.width + 'px';
					divMap.style.height = this.height + 'px';
					divMap.style.backgroundColor = this.bgColor;
					divMap.style.position = 'relative';
					divMap.id = 'divMapID';
					//å°†divè¿½åŠ åˆ°bodyä¸­
					document.body.appendChild(divMap);

				}
				//ç”±äºwindowæ˜¯å…¨å±€å¯¹è±¡,åŠ¨æ€ç»™windowæ·»åŠ ä¸€ä¸ªå±æ€§,å°†æ„é€ å‡½æ•°åèµ‹å€¼ç»™è¿™ä¸ªå±æ€§,
				//æ­¤æ—¶ä»å¤–ç•Œå°±å¯ä»¥è®¿é—®è¿™ä¸ªæ„é€ å‡½æ•°äº†
				window.MapG = MapG;
			})();

			//é£Ÿç‰©ç±»
			(function() {
				var elements = [];
				//é£Ÿç‰©æ„é€ å‡½æ•°
				function Food(width, height, bgColor) {
					this.width = width;
					this.height = height;
					this.bgColor = bgColor;
					//é£Ÿç‰©çš„xåæ ‡
					this.x = 0;
					//é£Ÿç‰©çš„yåæ ‡
					this.y = 0;
				}

				function remove() {
					var divMap = document.getElementById('divMapID');
					//ä»domä¸­åˆ é™¤,åœ¨ç½‘é¡µä¸­å°±çœ‹ä¸è§äº†
					for(var i = 0; i < elements.length; i++) {
						divMap.removeChild(elements[i]);
					}
					//æ¸…ç©ºæ•°ç»„,ä¿è¯æ•°ç»„ä¸­åªæœ‰ä¸€æ¡è›‡çš„div
					elements.splice(0);
					//console.log(elements);
				}
				Food.prototype.init = function() {
					remove();
					//è¿½åŠ åˆ°åœ°å›¾ä¸Š
					var divMap = document.getElementById('divMapID');
					//åˆ›å»ºé£Ÿç‰©div
					var divFood = document.createElement('div');
					//è®¾ç½®divcssæ ·å¼
					divFood.style.width = this.width + 'px';
					divFood.style.height = this.height + 'px';
					divFood.style.backgroundColor = this.bgColor;
					divFood.style.position = 'absolute';
					//console.log(divMap.offsetWidth);
					// åœ°å›¾çš„å®½åº¦/é£Ÿç‰©çš„å®½åº¦ = 40
					//éšæœºç”Ÿæˆä¸€ä¸ª0-40ä¹‹é—´çš„éšæœºå‘ä¸‹å–æ•´çš„æ•´æ•°(æ ¼æ•°)
					this.x = parseInt(Math.random() * (divMap.offsetWidth / this.width));
					this.y = parseInt(Math.random() * (divMap.offsetHeight / this.height));
					console.log(this.x);
					//æ ¼æ•°*é£Ÿç‰©çš„å®½åº¦ = åƒç´ å€¼
					divFood.style.left = this.x * this.width + 'px';
					divFood.style.top = this.y * this.height + 'px';

					divMap.appendChild(divFood);
					elements.push(divFood);
					//					console.log(divMap);
					/// åœ¨ç½‘é¡µä¸­(domæ ‘ä¸Šè‡ªèº«çš„å®½åº¦å°ºå¯¸)
					//					console.log(divFood.offsetWidth);
				}
				//å°†é£Ÿç‰©çš„æ„é€ å‡½æ•°å…¬å¸ƒåˆ°windowä¸Š
				window.Food = Food;
			})();

			//è›‡ç±»ğŸ
			(function() {
				// æ•°ç»„å­˜å‚¨è›‡çš„div
				var elements = [];

				function Snake(width, height, dir) {
					this.width = width;
					this.height = height;
					this.dir = dir;
					/*
					 * é»˜è®¤è›‡çš„ä¸‰éƒ¨åˆ†
					 */
					this.snBody = [{
						x: 3,
						y: 2,
						bgColor: 'red'
					}, {
						x: 2,
						y: 2,
						bgColor: 'orange'
					}, {
						x: 1,
						y: 2,
						bgColor: 'orange'
					}];
				}

				Snake.prototype.init = function() {

					//ç”Ÿæˆdivä¹‹å‰,å…ˆåˆ é™¤
					remove();

					var divMap = document.getElementById('divMapID');
					for(var i = 0; i < this.snBody.length; i++) {
						//åˆ›å»ºæ¯æ®µè›‡çš„div
						var divSnake = document.createElement('div');
						//è®¾ç½®æ¯æ®µdivçš„css
						divSnake.style.width = this.width + 'px';
						divSnake.style.height = this.height + 'px';
						divSnake.style.backgroundColor = this.snBody[i].bgColor;
						divSnake.style.position = 'absolute';
						divSnake.style.left = this.snBody[i].x * this.width + 'px';
						divSnake.style.top = this.snBody[i].y * this.height + 'px';
						//å°†æ¯æ®µè›‡æ·»åŠ åˆ°åœ°å›¾ä¸Š,æ·»åŠ åˆ°dom
						divMap.appendChild(divSnake);
						// å­˜å‚¨åˆ°æ•°ç»„ä¸­
						/*
						 * ç”±äºåœ¨åœ°å›¾ä¸­,è›‡,é£Ÿç‰©,éšœç¢ç‰©,éƒ½æ˜¯div,éƒ½æ˜¯åœ°å›¾çš„å­å…ƒç´ ,æ­¤æ—¶è¦æƒ³å‡†ç¡®
						 * çš„æ‰¾åˆ°ä¸‰æ®µè€è›‡çš„div,é€šè¿‡ç´¢å¼•æ˜¯ä¸å‡†ç¡®çš„.æ‰€ä»¥å°†æ¯æ¬¡ç”Ÿæˆè›‡çš„divå­˜åœ¨
						 * æ•°ç»„ä¸­,å¯ä»¥é€šè¿‡æ•°ç»„å‡†ç¡®çš„æ‰¾åˆ°ä¸‰ä¸ªdiv.
						 * åœ¨å°†è›‡çš„divæ·»åŠ åˆ°domæ—¶,å†å­˜å‚¨ä¸€ä»½åˆ°æ•°ç»„ä¸­
						 */
						elements.push(divSnake);
					}
					//console.log(elements);
				}
				//è›‡ç§»åŠ¨
				Snake.prototype.move = function() {
					/*
					 * å°†è›‡ä¸­çš„åæ ‡ç»™è›‡å°¾,å†å°†è›‡å¤´çš„åæ ‡ç»™è›‡ä¸­
					 */
					for(var i = this.snBody.length - 1; i > 0; i--) {
						this.snBody[i].x = this.snBody[i - 1].x;
						this.snBody[i].y = this.snBody[i - 1].y;
					}

					//è›‡å¤´çš„æ–¹å‘
					switch(this.dir) {
						case 'right':
							this.snBody[0].x += 1;
							break;
						case 'left':
							this.snBody[0].x -= 1;
							break;
						case 'top':
							this.snBody[0].y -= 1;
							break;
						case 'bottom':
							this.snBody[0].y += 1;
							break;

					}

					// è›‡å¤´xè‡ªåŠ 1

				}

				//åˆ é™¤æ“ä½œ
				function remove() {
					var divMap = document.getElementById('divMapID');
					//ä»domä¸­åˆ é™¤,åœ¨ç½‘é¡µä¸­å°±çœ‹ä¸è§äº†
					for(var i = 0; i < elements.length; i++) {
						divMap.removeChild(elements[i]);
					}
					//æ¸…ç©ºæ•°ç»„,ä¿è¯æ•°ç»„ä¸­åªæœ‰ä¸€æ¡è›‡çš„div
					elements.splice(0);
					//console.log(elements);
				}
				//å…¬å¸ƒåˆ°windowä¸Š
				window.Snake = Snake;

			})();

			//æ¸¸æˆç±»
			(function() {
				// å½“å‰è‡ªè°ƒç”¨å‡½æ•°çš„å±€éƒ¨å˜é‡
				var gameThis = null;
				//æ¸¸æˆæ„é€ å‡½æ•°
				function Game() {
					//ç”±äºwindowå¯ä»¥ä¸å†™,æ‰€ä»¥ç›´æ¥new MapG å’Œ new window.MapGæ˜¯ä¸€æ ·çš„
					this.mapG = new MapG(800, 600, '#ccc');
					//console.log(mapG);

					//å®ä¾‹åŒ–food
					this.food = new Food(20, 20, 'green');

					//console.log(food);
					//å®ä¾‹åŒ–è›‡
					this.snake = new Snake(20, 20, 'right');
					//è°ƒç”¨åˆå§‹åŒ–

					// 1.åˆ é™¤åœ°å›¾ä¸­çš„div,æ¸…ç©ºæ•°ç»„     2.æ ¹æ®snBodyä¸­çš„æ¯ä¸ªè›‡æ–­çš„åæ ‡ç”Ÿæˆè›‡div,æ·»åŠ åˆ°åœ°å›¾ä¸­

				}

				//åˆå§‹åŒ–æ¸¸æˆ
				Game.prototype.init = function() {
					//è°ƒç”¨åˆå§‹åŒ–å‡½æ•°,æ‰§è¡Œåˆ›å»ºdom
					this.mapG.init();
					//è°ƒç”¨åŸå‹å¯¹è±¡ä¸­çš„æ–¹æ³•
					this.food.init();
					//  æ·»åŠ æ•°ç»„
					this.snake.init();
				}

				//æ¸¸æˆè§„åˆ™
				Game.prototype.rule = function() {
					//console.log(this);
					//å­˜å‚¨æ¸¸æˆçš„å®ä¾‹å¯¹è±¡
					gameThis = this;
					//					 var divMap = document.getElementById('divMapID');
					var timer = setInterval(function() {
						gameThis.snake.move();
						gameThis.snake.init();

						//1.æ’å¢™æ­»
						if(gameThis.snake.snBody[0].x < 0 || gameThis.snake.snBody[0].x >= gameThis.mapG.width / gameThis.snake.width || (gameThis.snake.snBody[0].y < 0) || (gameThis.snake.snBody[0].y >= gameThis.mapG.height / gameThis.snake.height)) {
							clearInterval(timer);
							againGame();
						}
						
						
						//å†æ¥ä¸€æ¬¡
						function againGame() {
							var dialogDiv = document.createElement('div');
							dialogDiv.style.width = '300px';
							dialogDiv.style.height = '200px';
							dialogDiv.style.backgroundColor = 'rgba(255,0,0,0.5)';
							dialogDiv.style.width = '300px';
							dialogDiv.style.position = 'absolute';
							dialogDiv.style.left = '50%';
							dialogDiv.style.marginLeft = '-150px';
							dialogDiv.style.top = '50%';
							dialogDiv.style.marginTop = '-100px';
							document.body.appendChild(dialogDiv);
							dialogDiv.innerText = 'æ¸¸æˆç»“æŸ';
							var btn = document.createElement('button');
							btn.innerText = 'å†ç©ä¸€æ¬¡';
							dialogDiv.appendChild(btn);
							btn.onclick = function() {
								//åˆ·æ–°æµè§ˆå™¨
								window.location.reload();
							}
						}

						//2.åƒé£Ÿç‰©,é£Ÿç‰©åˆå§‹åŒ–,é•¿å°¾å·´
						if(gameThis.snake.snBody[0].x == gameThis.food.x && gameThis.snake.snBody[0].y == gameThis.food.y) {
							console.log('çœŸé¦™');
							//åˆå§‹åŒ–é£Ÿç‰©
							gameThis.food.init();
							var arr = ['blue', 'pink', '#f40', 'yellow', '#000'];
							//éšæœºç”Ÿæˆè›‡å°¾é¢œè‰²
//							var r = parseInt(Math.random() * arr.length);
//							var color = arr[r];
							//é•¿å°¾å·´
							var obj = {
								x: 5,
								y: 5,
								bgColor: color
							};
							gameThis.snake.snBody.push(obj);
						}
					}, 100);

				}
				//é”®ç›˜æŒ‰ä¸‹äº‹ä»¶
				document.onkeydown = function(e) {
					//					console.log(1);
					//					console.log(e);
					if(e.keyCode == 37) {
						//å·¦é”®
						gameThis.snake.dir = 'left';
					} else if(e.keyCode == 39) {
						//å³é”®
						gameThis.snake.dir = 'right';
					} else if(e.keyCode == 38) {
						//ä¸Šé”®
						gameThis.snake.dir = 'top';
					} else if(e.keyCode == 40) {
						//ä¸‹é”®
						gameThis.snake.dir = 'bottom';
					}
				}

				window.Game = Game;
			})();

			var game = new Game();
			game.init();
			game.rule();

			//			//ç”±äºwindowå¯ä»¥ä¸å†™,æ‰€ä»¥ç›´æ¥new MapG å’Œ new window.MapGæ˜¯ä¸€æ ·çš„
			//			var mapG = new MapG(800, 600, '#ccc');
			//			console.log(mapG);
			//			//è°ƒç”¨åˆå§‹åŒ–å‡½æ•°,æ‰§è¡Œåˆ›å»ºdom
			//			mapG.init();
			//			//å®ä¾‹åŒ–food
			//			var food = new Food(20, 20, 'green');
			//			//è°ƒç”¨åŸå‹å¯¹è±¡ä¸­çš„æ–¹æ³•
			//			food.init();
			//			console.log(food);
			//			//å®ä¾‹åŒ–è›‡
			//			var snake = new Snake(20,20,'right');
			//			//è°ƒç”¨åˆå§‹åŒ–
			//			
			//			// 1.åˆ é™¤åœ°å›¾ä¸­çš„div,æ¸…ç©ºæ•°ç»„     2.æ ¹æ®snBodyä¸­çš„æ¯ä¸ªè›‡æ–­çš„åæ ‡ç”Ÿæˆè›‡div,æ·»åŠ åˆ°åœ°å›¾ä¸­
			//			//  æ·»åŠ æ•°ç»„
			//			snake.init();
			//			var game = new Game();
			//			game.init();

			//			snake.move();
			//			snake.init();
			//			var timer = setInterval(function(){
			//				//  ä¼ å€¼
			//					snake.move();
			//					
			////					 1.åˆ é™¤åœ°å›¾ä¸­çš„div,æ¸…ç©ºæ•°ç»„     2.æ ¹æ®snBodyä¸­çš„æ¯ä¸ªè›‡æ–­çš„åæ ‡ç”Ÿæˆè›‡div,æ·»åŠ åˆ°åœ°å›¾ä¸­
			//			//  æ·»åŠ æ•°ç»„
			//					snake.init();
			//				
			//			},300);

			//			var jay = {
			//				name:'å‘¨æ°ä¼¦';
			//			}
			//			var jolin = {
			//				name:'è”¡ä¾æ—'
			//			}
			//			
			//			var a = jay;
			//			var b = jolin;
			//			
			//			
			//			var arr = [jay,jolin];
			//			arr[0]
			//			arr[1]
		</script>
	</body>

</html>